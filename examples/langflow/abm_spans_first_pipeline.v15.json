{
    "data": {
        "edges": [
            {
                "id": "edge-loader-to-validator",
                "source": "ABMChapterLoader-L1",
                "sourceHandle": "blocks_data",
                "target": "ABMBlockSchemaValidator-V1",
                "targetHandle": "blocks_data",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "blocks_data",
                        "id": "blocks_data",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "blocks_data",
                        "id": "blocks_data",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-validator-to-resolver",
                "source": "ABMBlockSchemaValidator-V1",
                "sourceHandle": "validated_blocks",
                "target": "ABMMixedBlockResolver-R1",
                "targetHandle": "validated_blocks",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "validated_blocks",
                        "id": "validated_blocks",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "validated_blocks",
                        "id": "validated_blocks",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-resolver-to-classifier",
                "source": "ABMMixedBlockResolver-R1",
                "sourceHandle": "spans",
                "target": "ABMSpanClassifier-C1",
                "targetHandle": "spans",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "spans",
                        "id": "spans",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "spans",
                        "id": "spans",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-classifier-to-attribution",
                "source": "ABMSpanClassifier-C1",
                "sourceHandle": "spans_cls",
                "target": "ABMSpanAttribution-A1",
                "targetHandle": "spans_cls",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_cls",
                        "id": "spans_cls",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_cls",
                        "id": "spans_cls",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-attribution-to-style",
                "source": "ABMSpanAttribution-A1",
                "sourceHandle": "spans_attr",
                "target": "ABMStylePlanner-SP1",
                "targetHandle": "spans_in",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_attr",
                        "id": "spans_attr",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_in",
                        "id": "spans_in",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-style-to-iterator",
                "source": "ABMStylePlanner-SP1",
                "sourceHandle": "spans_style",
                "target": "ABMSpanIterator-I1",
                "targetHandle": "spans_data",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_style",
                        "id": "spans_style",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_data",
                        "id": "spans_data",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            },
            {
                "id": "edge-attribution-to-casting",
                "source": "ABMSpanAttribution-A1",
                "sourceHandle": "spans_attr",
                "target": "ABMSpanCasting-CD1",
                "targetHandle": "spans_in",
                "type": "default",
                "data": {
                    "sourceHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_attr",
                        "id": "spans_attr",
                        "output_types": [
                            "Data"
                        ]
                    },
                    "targetHandle": {
                        "dataType": "Data",
                        "fieldName": "spans_in",
                        "id": "spans_in",
                        "input_types": [
                            "Data"
                        ],
                        "output_types": [
                            "Data"
                        ]
                    }
                }
            }
        ],
        "nodes": [
            {
                "id": "ABMChapterLoader-L1",
                "type": "genericNode",
                "position": {
                    "x": 40,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMChapterLoader-L1",
                    "type": "ABMChapterLoader",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Chapter Loader",
                        "description": "Unified loader: chapters/chapter/blocks",
                        "icon": "book-open",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Blocks Data",
                                "group_outputs": false,
                                "method": "load_and_blocks",
                                "name": "blocks_data",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "book_name": {
                                "_input_type": "StrInput",
                                "display_name": "Book Name",
                                "type": "str",
                                "value": "mvs",
                                "required": true
                            },
                            "base_data_dir": {
                                "_input_type": "StrInput",
                                "display_name": "Data Directory Path",
                                "type": "str",
                                "value": "data/clean"
                            },
                            "chapter_index": {
                                "_input_type": "IntInput",
                                "display_name": "Chapter Index (0-based)",
                                "type": "int",
                                "value": 0
                            },
                            "context_sentences": {
                                "_input_type": "IntInput",
                                "display_name": "Context Sentences",
                                "type": "int",
                                "value": 2
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMBlockSchemaValidator-V1",
                "type": "genericNode",
                "position": {
                    "x": 340,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMBlockSchemaValidator-V1",
                    "type": "ABMBlockSchemaValidator",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Block Schema Validator",
                        "description": "Normalize and compute block_uids; optional JSONL+meta",
                        "icon": "check-circle",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Validated Blocks",
                                "group_outputs": false,
                                "method": "validate_blocks",
                                "name": "validated_blocks",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "write_to_disk": {
                                "_input_type": "BoolInput",
                                "display_name": "Write JSONL + meta to disk",
                                "type": "bool",
                                "value": true
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMMixedBlockResolver-R1",
                "type": "genericNode",
                "position": {
                    "x": 640,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMMixedBlockResolver-R1",
                    "type": "ABMMixedBlockResolver",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Mixed-Block Resolver",
                        "description": "Split into dialogue/narration spans; compute span_uids; optional JSONL+meta",
                        "icon": "split",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Spans",
                                "group_outputs": false,
                                "method": "resolve_spans",
                                "name": "spans",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "write_to_disk": {
                                "_input_type": "BoolInput",
                                "display_name": "Write JSONL + meta to disk",
                                "type": "bool",
                                "value": true
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMSpanClassifier-C1",
                "type": "genericNode",
                "position": {
                    "x": 940,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMSpanClassifier-C1",
                    "type": "ABMSpanClassifier",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Span Classifier",
                        "description": "Deterministic span labeling",
                        "icon": "check-square",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Classified Spans",
                                "group_outputs": false,
                                "method": "classify_spans",
                                "name": "spans_cls",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "write_to_disk": {
                                "_input_type": "BoolInput",
                                "display_name": "Write JSONL + meta to disk",
                                "type": "bool",
                                "value": true
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMSpanAttribution-A1",
                "type": "genericNode",
                "position": {
                    "x": 1240,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMSpanAttribution-A1",
                    "type": "ABMSpanAttribution",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Span Attribution",
                        "description": "Heuristic speaker attribution for dialogue spans",
                        "icon": "user",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Attributed Spans",
                                "group_outputs": false,
                                "method": "attribute_spans",
                                "name": "spans_attr",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "write_to_disk": {
                                "_input_type": "BoolInput",
                                "display_name": "Write JSONL + meta to disk",
                                "type": "bool",
                                "value": true
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMSpanIterator-I1",
                "type": "genericNode",
                "position": {
                    "x": 1540,
                    "y": 40
                },
                "selected": false,
                "data": {
                    "id": "ABMSpanIterator-I1",
                    "type": "ABMSpanIterator",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Span Iterator",
                        "description": "Iterate spans with start/max and dialogue-only",
                        "icon": "repeat",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Current Span",
                                "group_outputs": false,
                                "method": "get_next_span",
                                "name": "current_span",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "dialogue_only": {
                                "_input_type": "BoolInput",
                                "display_name": "Dialogue only",
                                "type": "bool",
                                "value": true
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMStylePlanner-SP1",
                "type": "genericNode",
                "position": {
                    "x": 1540,
                    "y": 140
                },
                "selected": false,
                "data": {
                    "id": "ABMStylePlanner-SP1",
                    "type": "ABMStylePlanner",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Style Planner",
                        "description": "Vendor-neutral style plan (rate, emotion, pauses)",
                        "icon": "tuning",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Styled Spans",
                                "group_outputs": false,
                                "method": "plan_styles",
                                "name": "spans_style",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "write_to_disk": {
                                "_input_type": "BoolInput",
                                "display_name": "Write JSONL + meta",
                                "type": "bool",
                                "value": true
                            },
                            "output_dir": {
                                "_input_type": "StrInput",
                                "display_name": "Output Dir",
                                "type": "str",
                                "value": ""
                            }
                        }
                    }
                }
            },
            {
                "id": "ABMSpanCasting-CD1",
                "type": "genericNode",
                "position": {
                    "x": 1540,
                    "y": 240
                },
                "selected": false,
                "data": {
                    "id": "ABMSpanCasting-CD1",
                    "type": "ABMSpanCasting",
                    "showNode": true,
                    "node": {
                        "display_name": "ABM Span Casting",
                        "description": "Assign voices to spans using voice bank or fallback palette",
                        "icon": "user-voice",
                        "outputs": [
                            {
                                "allows_loop": false,
                                "cache": true,
                                "display_name": "Casted Spans",
                                "group_outputs": false,
                                "method": "assign_voices",
                                "name": "spans_cast",
                                "selected": "Data",
                                "tool_mode": true,
                                "types": [
                                    "Data"
                                ],
                                "value": "__UNDEFINED__"
                            }
                        ],
                        "template": {
                            "_type": "Component",
                            "voice_bank_path": {
                                "_input_type": "StrInput",
                                "display_name": "Voice Bank Path",
                                "type": "str",
                                "value": "data/casting/voice_bank.json"
                            }
                        }
                    }
                }
            }
        ]
    },
    "id": "abm_spans_first_pipeline",
    "last_tested_version": "v15",
    "name": "ABM Spans-First Pipeline (pre-SSML)"
}
